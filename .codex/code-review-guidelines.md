# GitHub Copilot CLI Code Review Configuration

このファイルは、GitHub Copilot CLI（Codex）を使用したコードレビューの具体的な指針を提供します。

## Copilot CLI レビューの特徴

### 1. インタラクティブレビュー
Copilot CLI の対話的な特性を活かしたレビューアプローチ：

```bash
# レビュー開始コマンド例
gh copilot ask "このPRの変更内容をレビューして、セキュリティとパフォーマンスの観点で問題を指摘してください"

# 具体的な問題分析
gh copilot explain "git diff HEAD~1 --name-only | xargs -I {} sh -c 'echo \"=== {} ===\" && cat {}'"

# 改善提案の生成
gh copilot suggest "このコードの品質を向上させるためのリファクタリング案を提示して"
```

### 2. コード安全性の重視
Copilot CLI が生成・提案するコードの安全性を特に重視：

```markdown
## セキュリティチェック項目
- [ ] 提案されたコマンドに危険な操作が含まれていないか
- [ ] 生成されたコードに機密情報が含まれていないか
- [ ] 外部ライブラリの使用が適切か（脆弱性チェック）
- [ ] 入力値の検証が十分か
```

### 3. コマンド実行の妥当性評価
提案されたコマンドが実際に期待通りの動作をするかを検証：

```markdown
## コマンド検証プロセス
1. **Dry-run実行**: 可能な場合は --dry-run オプションで事前確認
2. **副作用の分析**: ファイルシステム、ネットワーク、データベースへの影響
3. **ロールバック可能性**: 実行後に元に戻せるかの確認
4. **権限チェック**: 必要最小限の権限での実行可能性
```

## Copilot特有のレビューポイント

### 1. AI生成コードの品質評価
```markdown
## AI生成コード評価基準
- **正確性**: 意図した動作を正しく実行するか
- **効率性**: パフォーマンスが適切か
- **可読性**: 人間が理解・保守しやすいか
- **標準性**: プロジェクトの規約に従っているか
- **安全性**: セキュリティリスクがないか
```

### 2. コンテキスト理解の検証
Copilot の文脈理解が適切かを確認：

```bash
# プロジェクト固有の文脈確認
gh copilot ask "このプロジェクトのアーキテクチャパターンに従って、以下のコードが適切に実装されているか評価してください"

# 依存関係の理解確認  
gh copilot explain "このファイルの変更が他のモジュールに与える影響を分析してください"
```

### 3. 段階的改善プロセス
小さな改善を積み重ねるアプローチ：

```markdown
## 段階的レビュー手順
1. **基本動作確認**: コードが期待通りに動作するか
2. **品質改善**: 可読性・保守性の向上提案
3. **最適化**: パフォーマンス・効率性の改善
4. **安全性強化**: セキュリティ・エラーハンドリングの改善
```

## 実践的なレビューワークフロー

### Phase 1: 自動分析
```bash
# 変更ファイルの一覧と影響範囲確認
gh copilot suggest "git diff --name-only HEAD~1 | xargs ls -la"

# 複雑度の高いファイルの特定
gh copilot ask "このPRで変更されたファイルの中で、レビューに特に注意が必要なファイルはどれですか？"

# テストカバレッジの確認
gh copilot explain "npm test -- --coverage" 
```

### Phase 2: 対話的レビュー
```bash
# 個別ファイルの詳細レビュー
gh copilot ask "src/components/UserForm.jsx の変更について、以下の観点でレビューしてください：
1. React のベストプラクティス遵守
2. アクセシビリティ対応
3. セキュリティ（XSS対策等）
4. パフォーマンス最適化"

# 設計パターンの適用確認
gh copilot explain "このコンポーネントは適切なデザインパターンを使用していますか？改善案があれば提示してください"
```

### Phase 3: 総合評価
```bash
# 全体的な一貫性チェック
gh copilot ask "このPR全体を通して、コーディング規約や設計原則の一貫性に問題はありませんか？"

# 次のステップ提案
gh copilot suggest "このPRをマージする前に確認すべき追加のチェック項目を教えてください"
```

## レビューテンプレートとコマンド集

### 標準レビューテンプレート
```markdown
# Copilot CLI Code Review Checklist

## 🔍 自動分析結果
```bash
# 実行したコマンドと結果
gh copilot ask "..."
# → [結果の要約]
```

## ⚡ 主要な発見事項
### ✅ 良い実装
- [具体的な評価ポイント]

### ⚠️ 改善推奨事項
- **優先度高**: [セキュリティ・機能的問題]
- **優先度中**: [品質・保守性の問題]  
- **優先度低**: [最適化・スタイルの改善]

## 🛠️ 具体的な改善コマンド
```bash
# 提案する修正・改善のためのコマンド
gh copilot suggest "..."
```

## 🧪 テスト実行結果
```bash
# テスト関連のコマンドと結果
npm test
# → [結果サマリー]
```

## 📋 最終チェック項目
- [ ] すべてのテストが通ること
- [ ] linter/formatter の警告がないこと
- [ ] セキュリティスキャンの実行
- [ ] ドキュメントの更新確認
```

### よく使用するレビューコマンド集
```bash
# セキュリティレビュー
gh copilot ask "このコードにセキュリティ上の脆弱性はありませんか？特にSQLインジェクション、XSS、認証・認可の問題について確認してください"

# パフォーマンスレビュー  
gh copilot ask "このコードのパフォーマンスボトルネックを特定し、最適化の提案をしてください"

# 可読性・保守性レビュー
gh copilot ask "このコードの可読性と保守性を向上させるためのリファクタリング案を提示してください"

# テストレビュー
gh copilot ask "このコードに対して不足しているテストケースはありますか？特にエッジケースやエラーハンドリングについて"

# アーキテクチャレビュー
gh copilot ask "この実装がプロジェクト全体のアーキテクチャと一貫性を保っているか評価してください"

# 依存関係レビュー
gh copilot ask "新しく追加された依存関係の必要性と安全性について評価してください"
```

## 品質メトリクス

### レビューの効果測定
```bash
# コード品質指標の確認
gh copilot ask "このPRによってコードベースの品質指標（複雑度、重複度、テストカバレッジ等）はどのように変化しますか？"

# 技術的負債の評価
gh copilot ask "この変更によって技術的負債は増加しますか？将来のメンテナンスコストへの影響を評価してください"
```

### 継続的改善
```markdown
## 改善サイクル
1. **週次**: レビューで見つかった問題パターンの分析
2. **月次**: よく使用するコマンドの効率化・テンプレート更新
3. **四半期**: レビューガイドラインの見直しと改善
```

## ベストプラクティス

### Do's（推奨事項）
- コマンド実行前に影響範囲を確認する
- 複数の観点（セキュリティ、パフォーマンス、保守性）から評価する
- 具体的で実行可能な改善提案を行う
- AI の提案を鵜呑みにせず、常に検証する

### Don'ts（非推奨事項）  
- 破壊的なコマンドを確認なしに実行しない
- セキュリティ情報を含むコマンドを実行しない
- AI生成コードをレビューなしで採用しない
- 一度に大量の変更を提案しない

このガイドラインに従うことで、GitHub Copilot CLI を使用した効果的で安全なコードレビューを実現できます。