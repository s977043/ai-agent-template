# AI Agent Code Review Guidelines

このファイルは、AIエージェントがコードレビューを実行する際に従うべき包括的なガイドラインを提供します。

## レビューの基本方針

### 1. 仕様との整合性チェック
- `steering/` および `specs/` ディレクトリの仕様書との一致を確認
- 要件定義と実装の乖離がないかチェック  
- 受け入れ基準（Acceptance Criteria）の充足を検証

### 2. AI-TDD 原則の遵守
- テストファーストの実装になっているか
- 最小実装→リファクタのサイクルが守られているか
- テストカバレッジが適切か（ユニット/統合/E2E）

### 3. コード品質基準

#### 可読性とメンテナビリティ
- [ ] 関数・クラス名が目的を明確に示している
- [ ] 単一責任の原則（SRP）が守られている
- [ ] 適切なコメントが記述されている（なぜそうするかを説明）
- [ ] マジックナンバーや文字列が定数化されている

#### セキュリティチェック
- [ ] 機密情報（API キー、パスワード等）がハードコードされていない
- [ ] 入力値の検証（サニタイゼーション）が適切
- [ ] 権限チェックが実装されている
- [ ] SQLインジェクション等の脆弱性対策

#### エラーハンドリング
- [ ] 例外処理が適切に実装されている
- [ ] エラーメッセージが有用で具体的
- [ ] 失敗時の復旧処理が考慮されている
- [ ] ログ出力が適切なレベルで記録されている

#### パフォーマンス
- [ ] 不要なループやN+1問題がない
- [ ] リソースのリークがない（メモリ、ファイルハンドル等）
- [ ] データベースクエリが最適化されている
- [ ] キャッシュが適切に活用されている

## レビュー段階別チェック項目

### ステージ1: 基本構造レビュー
1. **ファイル構成の確認**
   - 既存のディレクトリ構造に従っているか
   - 命名規則が統一されているか
   - 依存関係が適切に整理されているか

2. **設計パターンの適用**
   - 既存コードベースのパターンを踏襲しているか
   - 類似機能との一貫性が保たれているか
   - 将来の拡張性が考慮されているか

### ステージ2: 実装詳細レビュー
1. **ロジックの正確性**
   - アルゴリズムが正しく実装されているか
   - 境界条件の処理が適切か
   - データフローに問題がないか

2. **テストの妥当性**
   - 重要なパスがテストされているか
   - エラーケースがカバーされているか
   - テストが決定的（deterministic）であるか

### ステージ3: 統合性レビュー
1. **既存システムとの整合性**
   - 既存APIとの互換性が保たれているか
   - データベーススキーマの変更が適切か
   - 設定ファイルの更新が反映されているか

2. **ドキュメント更新**
   - README.md や関連ドキュメントが更新されているか
   - APIドキュメントが最新状態か
   - 設定変更の手順が記載されているか

## AI エージェント別の特別考慮事項

### Claude Code レビュー
- `/kiro:` コマンドの仕様書との整合性を重視
- 段階的な設計プロセスの遵守を確認
- 仕様書の更新と実装の同期を検証

### GitHub Copilot CLI レビュー  
- コマンド生成の安全性を確認
- 提案されたコマンドの副作用をチェック
- 実行前の確認プロセスの有無を検証

### Gemini CLI レビュー
- 対話的な開発プロセスの記録を確認
- 意思決定の根拠が明確に記述されているか
- 探索的な実装の妥当性を評価

## レビューコメントの品質基準

### 建設的なフィードバック
- 問題の指摘だけでなく、改善案を提示する
- なぜその変更が必要かの理由を明確にする
- 代替案がある場合は、それぞれのトレードオフを説明する

### 優先度の明示
- **Critical**: セキュリティ、データ破損のリスク
- **High**: 機能不全、重大なバグ
- **Medium**: コード品質、保守性の問題
- **Low**: スタイル、最適化の提案

### レビューテンプレート
```markdown
## 📋 レビューサマリー
- 総合評価: [Approve/Request Changes/Comment]
- 重要な懸念: [あれば記載]
- 推奨アクション: [具体的な次のステップ]

## ✅ 良い点
- [具体的に評価できる点を列挙]

## ⚠️ 改善提案
- [優先度] [ファイル名:行番号] [問題の説明と改善案]

## 🔍 確認事項
- [ ] テストの実行結果を確認
- [ ] セキュリティチェックの実施
- [ ] パフォーマンステストの実行
```

## 自動化との連携

### CI/CD パイプラインとの統合
- 静的解析ツール（linter、security scanner）の結果を活用
- テスト結果とカバレッジレポートを参照
- ドキュメント生成ツールとの連携

### レビュー効率化
- 定型的なチェック項目は自動化ツールに委譲
- エージェントは創造的・戦略的な判断に集中
- 過去のレビューパターンから学習して改善

## チーム連携の原則

### 人間レビュアーとの協調
- エージェントレビューは一次チェックとして位置づけ
- 重要な設計判断は人間の確認を必須とする
- エージェントの判断根拠を明確に記録する

### 継続的改善
- レビュー品質のメトリクスを収集
- 見逃しやすい問題パターンを特定
- ガイドラインの定期的な見直しと更新

---

このガイドラインは、AI エージェントがより効果的で一貫性のあるコードレビューを実施するためのフレームワークです。プロジェクトの特性に合わせて適宜カスタマイズしてください。